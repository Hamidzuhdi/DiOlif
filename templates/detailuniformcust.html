<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Detail Seragam Pelanggan</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 40px; }
    .form-container { background: #fff; padding: 30px; border-radius: 8px; max-width: 700px; margin: auto; box-shadow: 0 1px 4px rgba(0,0,0,0.1);}
    table { width: 100%; border-collapse: collapse; margin-top: 18px; background: #fff; }
    th, td { padding: 10px 8px; border-bottom: 1px solid #eee; }
    th { background: #2979ff; color: #fff; }
    tr:last-child td { border-bottom: none; }
    .btn { padding: 6px 14px; border-radius: 4px; border: none; cursor: pointer; }
    .btn-edit { background: #ffc107; color: #222; }
    .btn-del { background: #ff4d4f; color: #fff; }
  </style>
</head>
<body>
  <div class="form-container">
    <h2 id="title">Detail Seragam Pelanggan</h2>
    <table>
      <thead>
        <tr>
          <th>Nama Seragam</th>
          <th>Ukuran</th>
          <th>Harga</th>
          <th>Catatan</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="uniformBody">
        <tr><td colspan="5" style="text-align:center;color:#aaa;">Memuat data...</td></tr>
      </tbody>
    </table>
    <a href="/customers" style="margin-top:15px;display:inline-block;color:#2979ff;">Kembali</a>
    <div id="responseMessage" style="margin-top:15px;"></div>
  </div>
  <script>
    const customerId = window.location.pathname.split('/').pop();
    // Ambil nama customer
    fetch('/api/customers/' + customerId)
      .then(res => res.json())
      .then(c => {
        document.getElementById('title').textContent = 'Detail Seragam: ' + c.name;
      });
    // Ambil daftar seragam customer
    fetch('/api/customers/' + customerId + '/uniforms')
      .then(res => res.json())
      .then(uniforms => {
        const tbody = document.getElementById('uniformBody');
        tbody.innerHTML = '';
        if (!uniforms.length) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#aaa;">Tidak ada data seragam</td></tr>';
          return;
        }
        uniforms.forEach(u => {
          tbody.innerHTML += `
            <tr>
              <td>${u.uniform_name}</td>
              <td>${u.size}</td>
              <td>Rp ${parseInt(u.price).toLocaleString('id-ID')}</td>
              <td>${u.notes || '-'}</td>
              <td>
                <button class="btn btn-edit" onclick="editUniform(${u.id})">Edit</button>
                <button class="btn btn-del" onclick="deleteUniform(${u.id})">Hapus</button>
                <a class="btn" style="background:#2979ff;color:#fff;margin-top:4px;display:inline-block;" href="/historyharga/${u.id}">Riwayat Harga</a>
              </td>
            </tr>
          `;
        });
      });

    function editUniform(id) {
      window.location.href = '/edit-custuniform/' + id;
    }
    function deleteUniform(id) {
      if (!confirm('Yakin ingin menghapus seragam ini?')) return;
      fetch('/api/customer-uniforms/' + id, { method: 'DELETE' })
        .then(res => {
          if (res.ok) location.reload();
          else document.getElementById('responseMessage').innerHTML = '<span style="color:red;">Gagal menghapus seragam</span>';
        });
    }
  </script>
</body>
</html>